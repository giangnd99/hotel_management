databaseChangeLog:
  - changeSet:
      id: V002__create_vouchers_table
      author: Nguyen Dam Hoang Linh
      comment: Create vouchers table for storing individual voucher information
      
      - createTable:
          tableName: vouchers
          columns:
            - column:
                name: id
                type: VARCHAR(36)
                constraints:
                  primaryKey: true
                  nullable: false
                  unique: true
            - column:
                name: voucher_code
                type: VARCHAR(20)
                constraints:
                  nullable: false
                  unique: true
            - column:
                name: discount_amount
                type: DECIMAL(10,2)
                constraints:
                  nullable: false
            - column:
                name: voucher_pack_id
                type: BIGINT
                constraints:
                  nullable: false
                  foreignKeyName: fk_vouchers_voucher_pack
                  references: voucher_packs(id)
            - column:
                name: customer_id
                type: VARCHAR(100)
                constraints:
                  nullable: false
            - column:
                name: redeemed_at
                type: TIMESTAMP
                defaultValueComputed: CURRENT_TIMESTAMP
                constraints:
                  nullable: false
            - column:
                name: valid_to
                type: TIMESTAMP
                constraints:
                  nullable: false
            - column:
                name: status
                type: VARCHAR(20)
                constraints:
                  nullable: false
                  checkConstraint: "status IN ('PENDING', 'REDEEMED', 'USED', 'EXPIRED')"
            - column:
                name: used_at
                type: TIMESTAMP
                constraints:
                  nullable: true
            - column:
                name: created_at
                type: TIMESTAMP
                defaultValueComputed: CURRENT_TIMESTAMP
                constraints:
                  nullable: false
            - column:
                name: updated_at
                type: TIMESTAMP
                defaultValueComputed: CURRENT_TIMESTAMP
                constraints:
                  nullable: true
            - column:
                name: version
                type: BIGINT
                defaultValueNumeric: 0
                constraints:
                  nullable: false
                  checkConstraint: "version >= 0"
      
      - sql:
          comment: Add table comment
          sql: COMMENT ON TABLE vouchers IS 'Stores individual voucher information including redemption details and usage status'
      
      - sql:
          comment: Add column comments
          sql: |
            COMMENT ON COLUMN vouchers.id IS 'Primary key identifier for the voucher (UUID)';
            COMMENT ON COLUMN vouchers.voucher_code IS 'Unique voucher code that customers use to redeem their discount';
            COMMENT ON COLUMN vouchers.discount_amount IS 'The discount amount that will be applied when this voucher is used';
            COMMENT ON COLUMN vouchers.voucher_pack_id IS 'Reference to the voucher pack from which this voucher was created';
            COMMENT ON COLUMN vouchers.customer_id IS 'Identifier of the customer who owns this voucher';
            COMMENT ON COLUMN vouchers.redeemed_at IS 'Timestamp when this voucher was redeemed by the customer';
            COMMENT ON COLUMN vouchers.valid_to IS 'Expiration date and time when this voucher becomes invalid';
            COMMENT ON COLUMN vouchers.status IS 'Current status of the voucher in the system';
            COMMENT ON COLUMN vouchers.used_at IS 'Timestamp when this voucher was first used in a transaction';
            COMMENT ON COLUMN vouchers.created_at IS 'Timestamp when this voucher was created in the system';
            COMMENT ON COLUMN vouchers.updated_at IS 'Timestamp when this voucher was last modified';
            COMMENT ON COLUMN vouchers.version IS 'Version field for optimistic locking';
