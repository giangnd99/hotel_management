databaseChangeLog:
  - changeSet:
      id: 004
      author: system
      comment: Create Spring Batch tables for job execution tracking
      changes:
        - createTable:
            tableName: BATCH_JOB_INSTANCE
            columns:
              - column:
                  name: JOB_INSTANCE_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
              - column:
                  name: JOB_NAME
                  type: VARCHAR(512)
                  constraints:
                    nullable: false
              - column:
                  name: JOB_KEY
                  type: VARCHAR(250)
            rollback:
              - dropTable:
                  tableName: BATCH_JOB_INSTANCE

        - createTable:
            tableName: BATCH_JOB_EXECUTION
            columns:
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
              - column:
                  name: JOB_INSTANCE_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: CREATE_TIME
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: START_TIME
                  type: TIMESTAMP
              - column:
                  name: END_TIME
                  type: TIMESTAMP
              - column:
                  name: STATUS
                  type: VARCHAR(10)
              - column:
                  name: EXIT_CODE
                  type: VARCHAR(2500)
              - column:
                  name: EXIT_MESSAGE
                  type: VARCHAR(2500)
              - column:
                  name: LAST_UPDATED
                  type: TIMESTAMP
            rollback:
              - dropTable:
                  tableName: BATCH_JOB_EXECUTION

        - createTable:
            tableName: BATCH_JOB_EXECUTION_PARAMS
            columns:
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: PARAMETER_NAME
                  type: VARCHAR(100)
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: PARAMETER_TYPE
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: PARAMETER_VALUE
                  type: VARCHAR(2500)
              - column:
                  name: IDENTIFYING
                  type: CHAR(1)
                  constraints:
                    nullable: false
            rollback:
              - dropTable:
                  tableName: BATCH_JOB_EXECUTION_PARAMS

        - createTable:
            tableName: BATCH_STEP_EXECUTION
            columns:
              - column:
                  name: STEP_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: STEP_NAME
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: CREATE_TIME
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: START_TIME
                  type: TIMESTAMP
              - column:
                  name: END_TIME
                  type: TIMESTAMP
              - column:
                  name: STATUS
                  type: VARCHAR(10)
              - column:
                  name: COMMIT_COUNT
                  type: BIGINT
              - column:
                  name: READ_COUNT
                  type: BIGINT
              - column:
                  name: FILTER_COUNT
                  type: BIGINT
              - column:
                  name: WRITE_COUNT
                  type: BIGINT
              - column:
                  name: READ_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: WRITE_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: PROCESS_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: ROLLBACK_COUNT
                  type: BIGINT
              - column:
                  name: EXIT_CODE
                  type: VARCHAR(2500)
              - column:
                  name: EXIT_MESSAGE
                  type: VARCHAR(2500)
              - column:
                  name: LAST_UPDATED
                  type: TIMESTAMP
            rollback:
              - dropTable:
                  tableName: BATCH_STEP_EXECUTION

        - createTable:
            tableName: BATCH_STEP_EXECUTION_SEQ
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
            rollback:
              - dropTable:
                  tableName: BATCH_STEP_EXECUTION_SEQ

        - createTable:
            tableName: BATCH_JOB_EXECUTION_SEQ
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
            rollback:
              - dropTable:
                  tableName: BATCH_JOB_EXECUTION_SEQ

        - createTable:
            tableName: BATCH_JOB_INSTANCE_SEQ
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
            rollback:
              - dropTable:
                  tableName: BATCH_JOB_INSTANCE_SEQ

        # Sequence initialization removed to avoid Liquibase Standard rollback issues
        # These sequences will be initialized by Spring Batch automatically when needed
        
        - createIndex:
            tableName: BATCH_JOB_INSTANCE
            indexName: IDX_BATCH_JOB_INSTANCE_JOB_KEY
            columns:
              - column:
                  name: JOB_KEY
        
        - createIndex:
            tableName: BATCH_JOB_INSTANCE
            indexName: IDX_BATCH_JOB_INSTANCE_JOB_NAME
            columns:
              - column:
                  name: JOB_NAME
        
        - createIndex:
            tableName: BATCH_JOB_EXECUTION
            indexName: IDX_BATCH_JOB_EXECUTION_JOB_INSTANCE_ID
            columns:
              - column:
                  name: JOB_INSTANCE_ID
        
        - createIndex:
            tableName: BATCH_JOB_EXECUTION
            indexName: IDX_BATCH_JOB_EXECUTION_STATUS
            columns:
              - column:
                  name: STATUS
        
        - createIndex:
            tableName: BATCH_STEP_EXECUTION
            indexName: IDX_BATCH_STEP_EXECUTION_JOB_EXECUTION_ID
            columns:
              - column:
                  name: JOB_EXECUTION_ID
        
        - createIndex:
            tableName: BATCH_STEP_EXECUTION
            indexName: IDX_BATCH_STEP_EXECUTION_STEP_NAME
            columns:
              - column:
                  name: STEP_NAME
